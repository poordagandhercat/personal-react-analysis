{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.js","webpack:///./src/my-react-js/index.js"],"names":["ReactDOM","React","App","props","useState","num","setNum","title","element","render","document","getElementById","createElement","type","children","map","child","createTextElement","text","nodeValue","createDom","vdom","dom","createTextNode","updateDom","prevProps","nextProps","Object","keys","filter","name","slice","removeEventListener","toLowerCase","addEventListener","container","wipRoot","base","currentRoot","delletions","nextUnitOfWork","commitRoot","forEach","commitWorker","fiber","domParentFiber","parent","domParent","effectTag","appendChild","commitDeletion","sibing","removeChild","workLoop","deadline","timeRemaining","performUnitOfWork","requestIdleCallback","isFunctionComponent","Function","updateFunctionComponent","updateHostComponent","nextFiber","wipFiber","hookIndex","init","oldHooks","hooks","hook","state","queue","actions","action","setState","push","reconcileChildren","elements","index","oldFiber","prevsibing","length","newFiber","sameType"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import React from './my-react-js';\nlet ReactDOM = React;\n\nfunction App(props) {\n    const [num, setNum] = React.useState(1)\n    return (\n        <div id=\"App\">\n            <div>{props.title}、{num}</div>\n            <button onClick={() => setNum(num + 1)}>累加</button>\n            <div>源码</div>\n        </div>\n    );\n}\n\nlet element = <App title=\"学习react\" />\n\nReactDOM.render(\n    element,\n    document.getElementById('root')\n);\n","// 创建虚拟DOM\nfunction createElement(type, props, ...children) {\n    return {\n        type,\n        props: {\n            ...props,\n            children: children.map(child => typeof child === 'object' ? child : createTextElement(child)),\n        },\n    };\n}\n// 文本类型虚拟DOM创建\nfunction createTextElement(text) {\n    return {\n        type: 'TEXT',\n        props: {\n            nodeValue: text,\n            children: [],\n        }\n    }\n}\n// 通过虚拟dom，新建DOM元素\nfunction createDom(vdom) {\n    const dom = vdom.type === 'TEXT' ? document.createTextNode('') : document.createElement(vdom.type);\n    updateDom(dom, {}, vdom.props);\n    return dom;\n}\nfunction updateDom(dom, prevProps, nextProps) {\n    // 1. 规避children属性\n    // 2. 老的存在，取消\n    // 3. 新的存在，新增 并没有做新老相等的判定\n    // @todo 兼容性\n    Object.keys(prevProps)\n        .filter(name => name !== 'children')\n        .filter(name => !(name in nextProps))\n        .filter(name => {\n            if (name.slice(0, 2)=== 'on') {\n                dom.removeEventListener(name.slice(0, 2).toLowerCase(), prevProps[name], false);\n            }\n            dom[name] = '';\n        })\n    Object.keys(nextProps)\n        .filter(name => name !== 'children')\n        .filter(name => {\n            if (name.slice(0, 2)=== 'on') {\n                dom.addEventListener(name.slice(0, 2).toLowerCase(), prevProps[name], false);\n            }\n            dom[name] = nextProps[name];\n        })\n}\n// 渲染虚拟DOM\nfunction render(vdom, container) {\n    wipRoot = {\n        dom: container,\n        props: {\n            children: [vdom],\n        },\n        base: currentRoot, // 存储上一个fiber根节点\n    };\n    delletions = [];\n    nextUnitOfWork = wipRoot;\n    // vdom.props.children.forEach(child => {\n    //     render(child, dom);\n    // })\n    // container.appendChild(dom);\n    // container.innerHTML = `<pre>${JSON.stringify(vdom, null, 2)}</pre>`\n}\n\nfunction commitRoot() {\n    delletions.forEach(commitWorker);\n    commitWorker(wipRoot.child);\n    currentRoot = wipRoot;\n    wipRoot = null;\n}\nfunction commitWorker(fiber) {\n    if (!fiber) return;\n    // const domParent = fiber.parent.dom;\n    // 向上查找\n    let domParentFiber = fiber.parent;\n    while (!domParentFiber.dom) {\n        domParentFiber = domParentFiber.parent;\n    }\n    const domParent = domParentFiber.dom;\n    if (fiber.effectTag === 'PLACEMENT' && fiber.dom !== null) {\n        domParent.appendChild(fiber.dom);\n    } else if (fiber.effectTag === 'DELETION') {\n        commitDeletion(fiber, domParent);\n    } else if (fiber.effectTag === 'UPDATE' && fiber.dom !== null) {\n        // 更新DOM\n        updateDom(fiber.dom, fiber.base.props, fiber.props);\n    }\n    // domParent.appendChild(fiber.dom);\n    commitWorker(fiber.child);\n    commitWorker(fiber.sibing);\n}\nfunction commitDeletion(fiber, domParent) {\n    if (fiber.dom) {\n        domParent.removeChild(fiber.dom);\n    } else {\n        commitDeletion(fiber.child, domParent);\n    }\n\n}\n// 下一个单元任务\nlet nextUnitOfWork = null;\n// 保存全局fiber的根结点\nlet wipRoot = null;\nlet currentRoot = null;\nlet delletions = null;\n// 调度diff或者渲染任务\nfunction workLoop(deadline) {\n    // 有下一个任务，且当前帧还没有结束\n    while(nextUnitOfWork && deadline.timeRemaining() > 1) {\n        nextUnitOfWork = performUnitOfWork(nextUnitOfWork);\n    }\n    // 如果没有任务了，并且根结点还在，提交\n    if (!nextUnitOfWork && wipRoot) commitRoot() \n    requestIdleCallback(workLoop);\n}\n// 启动空闲时间渲染\nrequestIdleCallback(workLoop);\n// 获取下一个任务\nfunction performUnitOfWork(fiber) {\n    const isFunctionComponent = fiber.type instanceof Function;\n    if (isFunctionComponent) {\n        updateFunctionComponent(fiber);\n    } else {\n        // 先不考虑class组件\n        // dom\n        updateHostComponent(fiber);\n    }\n\n    // 找下一个任务\n    // 先找子元素\n    if (fiber.child) return fiber.child;\n    // 没有子元素就找兄弟元素\n    let nextFiber = fiber;\n    while (nextFiber) {\n        if (nextFiber.sibing) return nextFiber.sibing;\n        // 没有兄弟元素了，找父元素\n        nextFiber = nextFiber.parent;\n    }\n}\n\nlet wipFiber = null;\nlet hookIndex = null;\nfunction useState(init) {\n    const oldHooks = wipFiber.base && wipFiber.base.hooks && wipFiber.base.hooks[hookIndex];\n    const hook = {\n        state: oldHooks ? oldHooks.state : init,\n        queue: [],\n    };\n    const actions = oldHooks ? oldHooks.queue : [];\n    actions.forEach((action) => hook.state = action);\n    const setState = (action) => {\n        hook.queue.push(action);\n        wipRoot = {\n            dom: currentRoot.dom,\n            props: currentRoot.props,\n            base: currentRoot,\n        };\n        nextUnitOfWork = wipRoot;\n        delletions = [];\n    }\n    wipFiber.hooks.push(hook);\n    hookIndex++;\n    return [hook.state, setState];\n}\n\nfunction updateFunctionComponent(fiber) {\n    wipFiber = fiber;\n    hookIndex = 0;\n    wipFiber.hooks = [];\n    const children = [fiber.type(fiber.props)];\n    reconcileChildren(fiber, children);\n}\nfunction updateHostComponent(fiber) {\n    // 根据当前任务，获取下一个\n    if (!fiber.dom) fiber.dom = createDom(fiber); // 不是入口\n    // if (fiber.parent) fiber.parent.dom.appendChild(fiber.dom); // 真实的DOM操作\n    reconcileChildren(fiber, fiber.props.children);\n}\nfunction reconcileChildren(wipFiber, elements) {\n    // 构建fiber结构\n    let index = 0;\n    let oldFiber = wipFiber.base && wipFiber.base.child;\n    let prevsibing = null;\n    while (index < elements.length && oldFiber != null) {\n    // while (index < elements.length) {\n        let element = elements[index];\n        const newFiber = null;\n\n        // 对比oldfiber的状态和当前element\n        // 先比较类型\n        const sameType = oldFiber && element && oldFiber.type == element.type;\n\n        if (sameType) {\n            // 复用节点，更新\n            newFiber = {\n                type: oldFiber.type,\n                props: element.props,\n                dom: oldFiber.dom,\n                parent: wipFiber,\n                base: oldFiber,\n                effectTag: 'UPDATE',\n            };\n        }\n        if (!sameType && element) {\n            // 替换节点\n            newFiber = {\n                type: element.type,\n                props: element.props,\n                dom: null,\n                parent: wipFiber,\n                base: null,\n                effectTag: 'PLACEMENT',\n            };\n        }\n        if (!sameType && oldFiber) {\n            // 删除\n            oldFiber.effectTag = 'DELETION';\n            delletions.push(oldFiber);\n        }\n\n        if (oldFiber) oldFiber = oldFiber.sibing;\n        if (index === 0) {\n            // 第一个元素是父fiber的child属性\n            wipFiber.child = newFiber;\n        } else {\n            prevsibing.sibing = newFiber;\n        }\n        prevsibing = newFiber;\n        index++;\n        // fiber结构（链表）基本构建结束\n    }\n    \n}\n\nexport default {\n    createElement,\n    render,\n    useState,\n}"],"sourceRoot":""}